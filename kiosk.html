<!DOCTYPE html>
<html class="light" lang="ja">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport" />
    <title>AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ | GBase Support</title>
    <meta name="description" content="å•†æ¥­æ–½è¨­å‘ã‘AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ã€‚åº—èˆ—æ¤œç´¢ã€ãƒ•ãƒ­ã‚¢æ¡ˆå†…ã€å¤šè¨€èªå¯¾å¿œãªã©ã€‚">

    <!-- Prevent zoom on touch devices -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#ee862b",
                        "primary-dark": "#d9731e",
                        "background": "#f5f5f5",
                        "surface": "#ffffff",
                        "text-main": "#1a1a1a",
                        "text-secondary": "#666666",
                        "border": "#e0e0e0",
                    },
                    fontFamily: {
                        "sans": ["Noto Sans JP", "sans-serif"],
                    },
                },
            },
        }
    </script>

    <style>
        /* Prevent text selection on touch */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Zone card styles */
        .zone-card {
            transition: all 0.2s ease;
        }
        .zone-card:hover {
            transform: translateY(-4px);
        }
        .zone-card.active {
            ring: 3px;
            transform: translateY(-2px);
        }
        .zone-card:active {
            transform: scale(0.98);
        }

        /* Prompt button styles */
        .prompt-btn {
            transition: all 0.15s ease;
        }
        .prompt-btn:hover {
            transform: translateX(4px);
        }
        .prompt-btn:active {
            transform: scale(0.98);
        }
        .prompt-btn.sending {
            background-color: #22c55e !important;
            color: white !important;
        }

        /* Color themes */
        .theme-blue { --theme-color: 59, 130, 246; }
        .theme-orange { --theme-color: 249, 115, 22; }
        .theme-pink { --theme-color: 236, 72, 153; }
        .theme-green { --theme-color: 34, 197, 94; }
        .theme-purple { --theme-color: 168, 85, 247; }

        .ring-theme { ring-color: rgba(var(--theme-color), 0.5); }
        .bg-theme-light { background-color: rgba(var(--theme-color), 0.1); }
        .text-theme { color: rgb(var(--theme-color)); }
        .border-theme { border-color: rgba(var(--theme-color), 0.3); }

        /* Idle timer */
        @keyframes countdown-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .countdown-pulse {
            animation: countdown-pulse 1s ease-in-out infinite;
        }

        /* Toast animation */
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        .animate-fade-in {
            animation: fade-in-up 0.3s ease-out;
        }
    </style>
</head>

<body class="bg-background font-sans text-text-main h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-surface border-b border-border px-4 lg:px-6 py-3 flex items-center justify-between shrink-0">
        <!-- Logo -->
        <a href="index.html" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
            <img src="https://cs.gbase.ai/title-logo.png" alt="GBase Support" class="h-8 lg:h-10" />
            <div class="hidden md:block">
                <p class="text-base lg:text-lg font-bold text-text-main">AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥</p>
            </div>
        </a>

        <!-- Language Selector -->
        <div class="relative">
            <button id="lang-toggle" onclick="toggleLangDropdown()" class="flex items-center gap-2 px-4 py-2 bg-background hover:bg-gray-200 rounded-xl border border-border transition-colors">
                <span id="current-lang-flag" class="text-2xl">ğŸ‡¯ğŸ‡µ</span>
                <span id="current-lang-name" class="text-sm font-medium hidden sm:inline">æ—¥æœ¬èª</span>
                <span class="material-symbols-outlined text-text-secondary text-lg">expand_more</span>
            </button>
            <!-- Language Dropdown -->
            <div id="lang-dropdown" class="hidden absolute right-0 top-full mt-2 bg-surface rounded-xl shadow-2xl border border-border w-72 z-50 p-3">
                <p class="text-xs text-text-secondary mb-2 px-2">è¨€èªã‚’é¸æŠ</p>
                <div class="grid grid-cols-2 gap-1" id="lang-buttons"></div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden">

        <!-- Left Panel: Zone Cards & Info -->
        <div class="w-full lg:w-[420px] xl:w-[480px] flex flex-col border-r border-border bg-surface shrink-0 overflow-hidden">

            <!-- Zone Cards (horizontal scroll on mobile, grid on desktop) -->
            <div class="p-4 border-b border-border shrink-0">
                <p id="zone-cards-title" class="text-sm font-bold text-text-secondary mb-3">ä½“é¨“ã‚’é¸æŠ</p>
                <div class="flex lg:grid lg:grid-cols-5 gap-2 overflow-x-auto pb-2 lg:pb-0 lg:overflow-visible" id="zone-cards">
                    <!-- Zone cards populated by JS -->
                </div>
            </div>

            <!-- Zone Detail Info -->
            <div class="flex-1 overflow-y-auto p-4 lg:p-5" id="zone-detail">
                <!-- Header -->
                <div class="mb-4">
                    <div id="zone-badge" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-bold mb-2 bg-blue-100 text-blue-600">
                        <span id="zone-icon">ğŸ«</span>
                        <span id="zone-label">ç·åˆæ¡ˆå†…</span>
                    </div>
                    <h2 id="zone-title" class="text-xl lg:text-2xl font-black text-text-main mb-2">ç·åˆæ¡ˆå†…ãƒ‡ã‚¹ã‚¯</h2>
                    <p id="zone-description" class="text-sm text-text-secondary leading-relaxed">å•†æ¥­æ–½è¨­ã®å…¥å£ã«è¨­ç½®ã•ã‚ŒãŸAIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ã€‚</p>
                </div>

                <!-- Features -->
                <div class="mb-4 p-4 bg-background rounded-xl">
                    <h3 class="text-sm font-bold text-text-main mb-3 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary text-lg">checklist</span>
                        <span id="features-title">ã“ã®ã‚¨ãƒªã‚¢ã®æ©Ÿèƒ½</span>
                    </h3>
                    <ul class="space-y-2" id="zone-features"></ul>
                </div>

                <!-- Try Prompts -->
                <div class="p-4 bg-primary/5 rounded-xl border border-primary/10">
                    <h3 class="text-sm font-bold text-text-main mb-3 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary text-lg">touch_app</span>
                        <span id="prompts-title">ã‚¿ãƒƒãƒ—ã—ã¦è©¦ã™</span>
                    </h3>
                    <div class="space-y-2" id="zone-prompts"></div>
                    <p id="prompts-hint" class="text-xs text-text-secondary mt-3 flex items-center gap-1">
                        <span class="material-symbols-outlined text-sm">touch_app</span>
                        ã‚¿ãƒƒãƒ—ã§è³ªå•ã‚’ç›´æ¥é€ä¿¡ï¼ˆåœ°å›³ã‚‚è¡¨ç¤ºå¯èƒ½ï¼‰
                    </p>
                </div>

                <!-- Language Selector for multilingual zone -->
                <div id="zone-lang-selector" class="hidden mt-4 p-4 bg-surface rounded-xl border border-border">
                    <h3 class="text-sm font-bold text-text-main mb-3 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary text-lg">translate</span>
                        è¨€èªã‚’é¸æŠ
                    </h3>
                    <div class="grid grid-cols-5 gap-2" id="zone-lang-buttons"></div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="p-4 border-t border-border bg-surface shrink-0 flex items-center justify-between">
                <button onclick="prevZone()" id="prev-btn" class="flex items-center gap-1 px-3 py-2 text-sm text-text-secondary hover:text-text-main disabled:opacity-30 transition-colors" disabled>
                    <span class="material-symbols-outlined text-lg">chevron_left</span>
                    <span id="prev-text">å‰ã¸</span>
                </button>
                <div class="flex gap-1" id="zone-dots"></div>
                <button onclick="nextZone()" id="next-btn" class="flex items-center gap-1 px-3 py-2 text-sm text-text-secondary hover:text-text-main transition-colors">
                    <span id="next-text">æ¬¡ã¸</span>
                    <span class="material-symbols-outlined text-lg">chevron_right</span>
                </button>
            </div>
        </div>

        <!-- Right Panel: Bot iframe -->
        <div class="flex-1 flex flex-col bg-background p-4 lg:p-6 min-h-0">
            <div class="flex-1 bg-surface rounded-2xl shadow-lg overflow-hidden flex flex-col">
                <!-- Bot Header -->
                <div id="bot-header" class="px-4 py-3 border-b border-border flex items-center justify-between bg-gradient-to-r from-blue-500 to-blue-600">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-white text-xl">smart_toy</span>
                        <span id="bot-title" class="text-white font-bold">ç·åˆæ¡ˆå†… AI</span>
                    </div>
                    <button onclick="reloadBot()" class="p-2 hover:bg-white/20 rounded-lg transition-colors" title="ãƒªãƒ­ãƒ¼ãƒ‰">
                        <span class="material-symbols-outlined text-white text-lg">refresh</span>
                    </button>
                </div>
                <!-- Bot iframe -->
                <div class="flex-1 relative">
                    <iframe
                        id="bot-iframe"
                        src=""
                        class="w-full h-full border-0"
                        allow="microphone"
                        title="AI Bot">
                    </iframe>
                    <!-- Loading overlay -->
                    <div id="bot-loading" class="absolute inset-0 bg-white flex items-center justify-center">
                        <div class="text-center">
                            <div class="w-12 h-12 border-4 border-primary/30 border-t-primary rounded-full animate-spin mx-auto mb-3"></div>
                            <p class="text-text-secondary text-sm">èª­ã¿è¾¼ã¿ä¸­...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Idle Timer Warning -->
            <div id="idle-warning" class="hidden mt-4 p-3 bg-amber-100 border border-amber-300 rounded-xl text-center">
                <p class="text-amber-800 text-sm font-medium countdown-pulse">
                    <span class="material-symbols-outlined text-lg align-middle mr-1">timer</span>
                    <span id="idle-countdown">30</span>ç§’å¾Œã«ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚Šã¾ã™
                </p>
            </div>
        </div>

    </main>

    <script>
        // ========== Configuration ==========
        var CONFIG = {
            // GBase API configuration
            apiKey: 'ak-xdVGAVu8Qq8H50FZ5jVYAiswGoSAmSs4X5iwQGa61lzEMb0N',
            aiId: 'a182ac3e-0552-4fc0-aced-cd995e5f91c2',
            apiEndpoint: 'https://api.gbase.ai/v1/question/',
            // Widget wrapper for postMessage support
            botBaseUrl: 'bot-wrapper.html',
            realtimeUrl: 'https://gbase.ai/realtime/a182ac3e-0552-4fc0-aced-cd995e5f91c2',
            idleTimeout: 60,
            idleWarningAt: 15
        };

        // Current session ID for API calls
        var currentSessionId = null;

        // ========== Zone Data (from mall.html) ==========
        // All zones use full bot URL (supports canvas/maps)
        var zones = [
            {
                id: 0,
                icon: 'ğŸ«',
                label: 'ç·åˆæ¡ˆå†…',
                title: 'ç·åˆæ¡ˆå†…ãƒ‡ã‚¹ã‚¯',
                color: 'blue',
                gradient: 'from-blue-500 to-blue-600',
                urlBase: CONFIG.botBaseUrl,
                showLangSelector: true,
                description: 'å•†æ¥­æ–½è¨­ã®å…¥å£ã«è¨­ç½®ã•ã‚ŒãŸAIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ã€‚å–¶æ¥­æ™‚é–“ã€ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã€æ–½è¨­ã®åŸºæœ¬æ¡ˆå†…ãªã©ã€ã‚ˆãã‚ã‚‹è³ªå•ã«å³åº§ã«å›ç­”ã—ã¾ã™ã€‚',
                features: ['å–¶æ¥­æ™‚é–“ãƒ»å®šä¼‘æ—¥ã®æ¡ˆå†…', 'ã‚¤ãƒ™ãƒ³ãƒˆãƒ»ã‚»ãƒ¼ãƒ«æƒ…å ±', 'é§è»Šå ´ãƒ»ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±', 'æ–½è¨­ã‚µãƒ¼ãƒ“ã‚¹æ¡ˆå†…'],
                prompts: ['å–¶æ¥­æ™‚é–“ã‚’æ•™ãˆã¦', 'ä»Šæ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ï¼Ÿ', 'é§è»Šå ´ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', 'ãƒ™ãƒ“ãƒ¼ã‚«ãƒ¼ã‚’å€Ÿã‚ŠãŸã„']
            },
            {
                id: 1,
                icon: 'ğŸ—ºï¸',
                label: 'ãƒ•ãƒ­ã‚¢ãƒŠãƒ“',
                title: 'ãƒ•ãƒ­ã‚¢ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³',
                color: 'orange',
                gradient: 'from-orange-500 to-orange-600',
                urlBase: CONFIG.botBaseUrl,
                showLangSelector: false,
                description: 'ã€Œãƒ¦ãƒ‹ã‚¯ãƒ­ã¯ã©ã“ï¼Ÿã€ã¨èãã ã‘ã§ã€ç¾åœ¨åœ°ã‹ã‚‰ç›®çš„åœ°ã¾ã§ã®æœ€çŸ­ãƒ«ãƒ¼ãƒˆã‚’3Dãƒãƒƒãƒ—ã§è¡¨ç¤ºã—ã¾ã™ã€‚',
                features: ['åº—èˆ—ã¸ã®é“é †æ¡ˆå†…', '3Dãƒ•ãƒ­ã‚¢ãƒãƒƒãƒ—è¡¨ç¤º', 'ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼/éšæ®µã®é¸æŠ', 'æ›–æ˜§ãªè¦æœ›ã‹ã‚‰åº—èˆ—ææ¡ˆ'],
                prompts: ['ãƒ¦ãƒ‹ã‚¯ãƒ­ã¯ã©ã“ï¼Ÿ', 'ãƒˆã‚¤ãƒ¬ã«è¡ŒããŸã„', 'å­ä¾›æœã®ãŠåº—ã‚’æ•™ãˆã¦', 'ATMã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ']
            },
            {
                id: 2,
                icon: 'ğŸ›ï¸',
                label: 'å•†å“æ¤œç´¢',
                title: 'å•†å“æ¤œç´¢ãƒ»åœ¨åº«ç¢ºèª',
                color: 'pink',
                gradient: 'from-pink-500 to-pink-600',
                urlBase: CONFIG.botBaseUrl,
                showLangSelector: false,
                description: 'ã€Œèµ¤ã„ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹ãŒæ¬²ã—ã„ã€ãªã©æ›–æ˜§ãªè¦æœ›ã‹ã‚‰ã€è¤‡æ•°åº—èˆ—ã®å•†å“ã‚’æ¨ªæ–­æ¤œç´¢ã€‚åœ¨åº«çŠ¶æ³ã‚‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèªã§ãã¾ã™ã€‚',
                features: ['è¤‡æ•°åº—èˆ—æ¨ªæ–­æ¤œç´¢', 'æ›–æ˜§ãªè¦æœ›ã‹ã‚‰å•†å“ææ¡ˆ', 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åœ¨åº«ç¢ºèª', 'ä¾¡æ ¼å¸¯ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰çµã‚Šè¾¼ã¿'],
                prompts: ['èµ¤ã„ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹ãŒæ¬²ã—ã„', 'å­ä¾›ç”¨ã®é´ã‚’æ¢ã—ã¦', 'äºˆç®—5000å††ã§ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ', 'ä»Šã‚»ãƒ¼ãƒ«ä¸­ã®å•†å“ã¯ï¼Ÿ']
            },
            {
                id: 3,
                icon: 'ğŸŒ',
                label: 'å¤šè¨€èª',
                title: 'å¤šè¨€èªå¯¾å¿œï¼ˆ10è¨€èªä»¥ä¸Šï¼‰',
                color: 'green',
                gradient: 'from-green-500 to-green-600',
                urlBase: CONFIG.botBaseUrl,
                showLangSelector: true,
                description: 'è‹±èªã€ä¸­å›½èªã€éŸ“å›½èªãªã©10è¨€èªä»¥ä¸Šã«è‡ªå‹•å¯¾å¿œã€‚å¤–å›½äººè¦³å…‰å®¢ã‚‚æ¯å›½èªã§å¿«é©ã«åˆ©ç”¨ã§ãã¾ã™ã€‚',
                features: ['10è¨€èªä»¥ä¸Šã®è‡ªå‹•ç¿»è¨³', 'å…ç¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ¡ˆå†…', 'å¤–è²¨ä¸¡æ›¿æ‰€ã®æ¡ˆå†…', 'Wi-Fiãƒ»SIMã‚«ãƒ¼ãƒ‰æƒ…å ±'],
                prompts: ['Where is the restroom?', 'å…ç¨æŸœå°åœ¨å“ªé‡Œï¼Ÿ', 'í™”ì¥ì‹¤ì´ ì–´ë””ì—ìš”?', 'à¸«à¹‰à¸­à¸‡à¸™à¹‰à¸³à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¹„à¸«à¸™?']
            },
            {
                id: 4,
                icon: 'ğŸ¤',
                label: 'éŸ³å£°ä¼šè©±',
                title: 'éŸ³å£°ä¼šè©±ï¼ˆãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼ï¼‰',
                color: 'purple',
                gradient: 'from-purple-500 to-purple-600',
                urlBase: CONFIG.realtimeUrl,
                showLangSelector: false,
                description: 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã¯ä¸è¦ã€‚è©±ã—ã‹ã‘ã‚‹ã ã‘ã§ã€AIãŒæ„å›³ã‚’ç†è§£ã—çš„ç¢ºã«æ¡ˆå†…ã—ã¾ã™ã€‚é«˜é½¢è€…ã‚„æ‰‹ãŒãµã•ãŒã£ã¦ã„ã‚‹æ–¹ã«ã‚‚æœ€é©ã€‚',
                features: ['ãƒãƒ³ã‚ºãƒ•ãƒªãƒ¼éŸ³å£°æ“ä½œ', 'é¨’ãŒã—ã„ç’°å¢ƒã§ã‚‚èªè­˜', 'æ–¹è¨€ãƒ»ã‚¢ã‚¯ã‚»ãƒ³ãƒˆå¯¾å¿œ', 'éŸ³å£°ã§å›ç­”èª­ã¿ä¸Šã’'],
                prompts: ['ğŸ™ï¸ ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—', 'å£°ã§è³ªå•ã—ã¦ã¿ã‚ˆã†', 'è¿‘ãã®ã‚«ãƒ•ã‚§ã‚’æ•™ãˆã¦', 'ãŠæ‰‹æ´—ã„ã¯ã©ã“ã§ã™ã‹']
            }
        ];

        // ========== Language Data ==========
        var languages = [
            { code: 'ja', flag: 'ğŸ‡¯ğŸ‡µ', name: 'æ—¥æœ¬èª' },
            { code: 'en', flag: 'ğŸ‡ºğŸ‡¸', name: 'English' },
            { code: 'zh', flag: 'ğŸ‡¨ğŸ‡³', name: 'ä¸­æ–‡' },
            { code: 'ko', flag: 'ğŸ‡°ğŸ‡·', name: 'í•œêµ­ì–´' },
            { code: 'vi', flag: 'ğŸ‡»ğŸ‡³', name: 'Tiáº¿ng Viá»‡t' },
            { code: 'pt', flag: 'ğŸ‡§ğŸ‡·', name: 'PortuguÃªs' },
            { code: 'id', flag: 'ğŸ‡®ğŸ‡©', name: 'Indonesia' },
            { code: 'th', flag: 'ğŸ‡¹ğŸ‡­', name: 'à¹„à¸—à¸¢' },
            { code: 'ne', flag: 'ğŸ‡³ğŸ‡µ', name: 'à¤¨à¥‡à¤ªà¤¾à¤²à¥€' },
            { code: 'es', flag: 'ğŸ‡ªğŸ‡¸', name: 'EspaÃ±ol' }
        ];

        // ========== State ==========
        var currentZone = 0;
        var currentLang = 'ja';
        var idleTimer = null;
        var countdownTimer = null;
        var countdownValue = CONFIG.idleTimeout;

        // ========== Color Maps ==========
        var colorMap = {
            blue: { bg: 'bg-blue-100', text: 'text-blue-600', border: 'border-blue-200', ring: 'ring-blue-400', icon: 'text-blue-500' },
            orange: { bg: 'bg-orange-100', text: 'text-orange-600', border: 'border-orange-200', ring: 'ring-orange-400', icon: 'text-orange-500' },
            pink: { bg: 'bg-pink-100', text: 'text-pink-600', border: 'border-pink-200', ring: 'ring-pink-400', icon: 'text-pink-500' },
            green: { bg: 'bg-green-100', text: 'text-green-600', border: 'border-green-200', ring: 'ring-green-400', icon: 'text-green-500' },
            purple: { bg: 'bg-purple-100', text: 'text-purple-600', border: 'border-purple-200', ring: 'ring-purple-400', icon: 'text-purple-500' }
        };

        // ========== Initialize Zone Cards ==========
        function initZoneCards() {
            var container = document.getElementById('zone-cards');
            container.replaceChildren();

            zones.forEach(function(zone, index) {
                var colors = colorMap[zone.color];
                var card = document.createElement('button');
                card.className = 'zone-card flex-shrink-0 w-20 lg:w-auto flex flex-col items-center gap-1 p-3 rounded-xl border-2 transition-all ' +
                    (index === currentZone ? colors.bg + ' ' + colors.border + ' ring-2 ' + colors.ring : 'bg-white border-gray-200 hover:' + colors.border);
                card.dataset.zone = index;
                card.onclick = function() { selectZone(index); };

                var icon = document.createElement('span');
                icon.className = 'text-2xl lg:text-3xl';
                icon.textContent = zone.icon;

                var label = document.createElement('span');
                label.className = 'text-xs font-medium ' + (index === currentZone ? colors.text : 'text-text-secondary');
                label.textContent = zone.label;

                card.appendChild(icon);
                card.appendChild(label);
                container.appendChild(card);
            });
        }

        // ========== Initialize Zone Dots ==========
        function initZoneDots() {
            var container = document.getElementById('zone-dots');
            container.replaceChildren();

            zones.forEach(function(zone, index) {
                var colors = colorMap[zone.color];
                var dot = document.createElement('button');
                dot.className = 'w-2 h-2 rounded-full transition-all ' +
                    (index === currentZone ? 'w-6 ' + colors.bg.replace('100', '500') : 'bg-gray-300');
                dot.onclick = function() { selectZone(index); };
                container.appendChild(dot);
            });
        }

        // ========== Select Zone ==========
        function selectZone(index) {
            currentZone = index;
            var zone = zones[index];
            var colors = colorMap[zone.color];

            // Update cards
            initZoneCards();
            initZoneDots();

            // Update badge
            var badge = document.getElementById('zone-badge');
            badge.className = 'inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-bold mb-2 ' + colors.bg + ' ' + colors.text;
            document.getElementById('zone-icon').textContent = zone.icon;
            document.getElementById('zone-label').textContent = zone.label;

            // Update text
            document.getElementById('zone-title').textContent = zone.title;
            document.getElementById('zone-description').textContent = zone.description;

            // Update features
            var featuresList = document.getElementById('zone-features');
            featuresList.replaceChildren();
            zone.features.forEach(function(feature) {
                var li = document.createElement('li');
                li.className = 'flex items-start gap-2 text-sm';

                var icon = document.createElement('span');
                icon.className = 'material-symbols-outlined text-base mt-0.5 ' + colors.icon;
                icon.textContent = 'check_circle';

                var text = document.createElement('span');
                text.className = 'text-text-main';
                text.textContent = feature;

                li.appendChild(icon);
                li.appendChild(text);
                featuresList.appendChild(li);
            });

            // Update prompts
            var promptsContainer = document.getElementById('zone-prompts');
            promptsContainer.replaceChildren();
            zone.prompts.forEach(function(prompt, i) {
                var btn = document.createElement('button');
                btn.className = 'prompt-btn w-full text-left px-4 py-3 bg-white hover:bg-gray-50 border border-border rounded-xl text-sm text-text-main flex items-center gap-3 transition-all';
                btn.onclick = function() { sendPrompt(prompt, btn); };

                var num = document.createElement('span');
                num.className = 'w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ' + colors.bg + ' ' + colors.text;
                num.textContent = i + 1;

                var text = document.createElement('span');
                text.className = 'flex-1';
                text.textContent = prompt;

                var arrow = document.createElement('span');
                arrow.className = 'material-symbols-outlined text-text-secondary text-lg';
                arrow.textContent = 'send';

                btn.appendChild(num);
                btn.appendChild(text);
                btn.appendChild(arrow);
                promptsContainer.appendChild(btn);
            });

            // Update bot header
            var botHeader = document.getElementById('bot-header');
            botHeader.className = 'px-4 py-3 border-b border-border flex items-center justify-between bg-gradient-to-r ' + zone.gradient;
            document.getElementById('bot-title').textContent = zone.label + ' AI';

            // Show/hide language selector
            var langSelector = document.getElementById('zone-lang-selector');
            if (zone.showLangSelector) {
                langSelector.classList.remove('hidden');
                initZoneLangButtons();
            } else {
                langSelector.classList.add('hidden');
            }

            // Update navigation
            document.getElementById('prev-btn').disabled = index === 0;
            document.getElementById('next-btn').disabled = index === zones.length - 1;

            // Load bot
            loadBot();
            resetIdleTimer();
        }

        // ========== Load Bot ==========
        function loadBot() {
            var zone = zones[currentZone];
            var iframe = document.getElementById('bot-iframe');
            var loading = document.getElementById('bot-loading');

            // Reset session when switching zones
            currentSessionId = null;

            loading.classList.remove('hidden');

            // Use full bot URL for zones (supports canvas/maps)
            // Voice zone uses realtime URL
            var url = zone.urlBase;
            if (url.includes('gbase.ai/bot/') || url.includes('gbase.ai/realtime/')) {
                url = url + '?lang=' + currentLang;
            } else {
                url = url + '?lang=' + currentLang;
            }
            iframe.src = url;

            iframe.onload = function() {
                // Give bot time to initialize
                setTimeout(function() {
                    loading.classList.add('hidden');
                }, 1000);
            };
        }

        function reloadBot() {
            loadBot();
        }

        // ========== Generate UUID ==========
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0;
                var v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // ========== Send Prompt to Bot ==========
        function sendPrompt(prompt, btn) {
            // Skip if it's a voice instruction
            if (prompt.includes('ğŸ™ï¸') || prompt.includes('ãƒã‚¤ã‚¯') || prompt.includes('å£°ã§')) {
                return;
            }

            // Visual feedback - show sending state
            btn.classList.add('sending');
            var arrow = btn.querySelector('.material-symbols-outlined:last-child');
            var originalText = arrow ? arrow.textContent : '';
            if (arrow) arrow.textContent = 'hourglass_empty';

            var iframe = document.getElementById('bot-iframe');

            // Send message to bot-wrapper.html which forwards to widget
            // The widget supports: { type: 'send', question: '...' }
            try {
                iframe.contentWindow.postMessage({ type: 'send', question: prompt }, '*');
                console.log('PostMessage sent to bot wrapper:', prompt);

                if (arrow) arrow.textContent = 'check';
                showToast('è³ªå•ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼');
            } catch (error) {
                console.error('PostMessage Error:', error);
                if (arrow) arrow.textContent = 'error';
                showToast('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }

            // Reset button after delay
            setTimeout(function() {
                btn.classList.remove('sending');
                if (arrow) arrow.textContent = originalText;
            }, 2000);

            resetIdleTimer();
        }

        // ========== Toast Notification ==========
        function showToast(message) {
            // Remove existing toast
            var existingToast = document.getElementById('toast');
            if (existingToast) existingToast.remove();

            // Create toast
            var toast = document.createElement('div');
            toast.id = 'toast';
            toast.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-2 z-50 animate-fade-in';

            var icon = document.createElement('span');
            icon.className = 'material-symbols-outlined text-green-400';
            icon.textContent = 'check_circle';

            var text = document.createElement('span');
            text.className = 'text-sm font-medium';
            text.textContent = message;

            toast.appendChild(icon);
            toast.appendChild(text);
            document.body.appendChild(toast);

            // Remove after delay
            setTimeout(function() {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s ease';
                setTimeout(function() { toast.remove(); }, 300);
            }, 3000);
        }

        // ========== Language Functions ==========
        function initLangButtons() {
            var container = document.getElementById('lang-buttons');
            container.replaceChildren();
            languages.forEach(function(lang) {
                container.appendChild(createLangButton(lang, lang.code === currentLang, function() {
                    changeLang(lang.code);
                }));
            });
        }

        function initZoneLangButtons() {
            var container = document.getElementById('zone-lang-buttons');
            container.replaceChildren();
            languages.forEach(function(lang) {
                container.appendChild(createLangButton(lang, lang.code === currentLang, function() {
                    changeLang(lang.code);
                }));
            });
        }

        function createLangButton(lang, isActive, onClick) {
            var btn = document.createElement('button');
            btn.className = 'flex flex-col items-center gap-1 p-2 rounded-lg transition-all ' +
                (isActive ? 'bg-primary/10 ring-2 ring-primary' : 'hover:bg-gray-100');
            btn.onclick = onClick;

            var flag = document.createElement('span');
            flag.className = 'text-xl';
            flag.textContent = lang.flag;

            var name = document.createElement('span');
            name.className = 'text-xs ' + (isActive ? 'text-primary font-bold' : 'text-text-secondary');
            name.textContent = lang.name;

            btn.appendChild(flag);
            btn.appendChild(name);
            return btn;
        }

        function toggleLangDropdown() {
            document.getElementById('lang-dropdown').classList.toggle('hidden');
        }

        function changeLang(langCode) {
            currentLang = langCode;
            var lang = languages.find(function(l) { return l.code === langCode; });
            if (lang) {
                document.getElementById('current-lang-flag').textContent = lang.flag;
                document.getElementById('current-lang-name').textContent = lang.name;
            }
            document.getElementById('lang-dropdown').classList.add('hidden');
            initLangButtons();
            initZoneLangButtons();
            loadBot();
        }

        // ========== Navigation ==========
        function prevZone() {
            if (currentZone > 0) selectZone(currentZone - 1);
        }

        function nextZone() {
            if (currentZone < zones.length - 1) selectZone(currentZone + 1);
        }

        // ========== Idle Timer ==========
        function startIdleTimer() {
            clearIdleTimer();
            countdownValue = CONFIG.idleTimeout;
            idleTimer = setTimeout(showIdleWarning, (CONFIG.idleTimeout - CONFIG.idleWarningAt) * 1000);
        }

        function showIdleWarning() {
            var warning = document.getElementById('idle-warning');
            var countdown = document.getElementById('idle-countdown');
            countdownValue = CONFIG.idleWarningAt;
            countdown.textContent = countdownValue;
            warning.classList.remove('hidden');

            countdownTimer = setInterval(function() {
                countdownValue--;
                countdown.textContent = countdownValue;
                if (countdownValue <= 0) {
                    // Return to first zone
                    selectZone(0);
                    clearIdleTimer();
                }
            }, 1000);
        }

        function clearIdleTimer() {
            if (idleTimer) { clearTimeout(idleTimer); idleTimer = null; }
            if (countdownTimer) { clearInterval(countdownTimer); countdownTimer = null; }
            document.getElementById('idle-warning').classList.add('hidden');
        }

        function resetIdleTimer() {
            startIdleTimer();
        }

        // ========== Event Listeners ==========
        document.addEventListener('click', function(e) {
            var toggle = document.getElementById('lang-toggle');
            var dropdown = document.getElementById('lang-dropdown');
            if (!toggle.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.add('hidden');
            }
            resetIdleTimer();
        });

        document.addEventListener('touchstart', resetIdleTimer);
        document.addEventListener('keydown', function(e) {
            resetIdleTimer();
            if (e.key >= '1' && e.key <= '5') selectZone(parseInt(e.key) - 1);
            else if (e.key === 'ArrowLeft') prevZone();
            else if (e.key === 'ArrowRight') nextZone();
        });

        document.addEventListener('contextmenu', function(e) { e.preventDefault(); });

        // ========== Initialize ==========
        (function init() {
            initLangButtons();
            initZoneCards();
            initZoneDots();

            var urlParams = new URLSearchParams(window.location.search);
            var zoneParam = urlParams.get('zone');
            var langParam = urlParams.get('lang');

            if (langParam && languages.some(function(l) { return l.code === langParam; })) {
                currentLang = langParam;
                var lang = languages.find(function(l) { return l.code === langParam; });
                document.getElementById('current-lang-flag').textContent = lang.flag;
                document.getElementById('current-lang-name').textContent = lang.name;
            }

            var startZone = 0;
            if (zoneParam !== null) {
                var z = parseInt(zoneParam);
                if (z >= 0 && z < zones.length) startZone = z;
            }
            selectZone(startZone);
        })();
    </script>

</body>

</html>
